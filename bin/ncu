#!/usr/bin/env bash
SCRIPT_PATH="$( cd "$(dirname "$0")" ; pwd -P )"
if [[ $1 == "clv-install" ]]; then
    if [[ ! -e ~/.clv/bin/ncu ]]; then
        "$SCRIPT_PATH"/npm clv-install
        if [[ -e ~/.clv/bin/npm ]]; then
            echo "clv is installing ncu"
            npm i -g npm-check-updates
            if [[ -e ~/.clv/home/node/bin/ncu ]]; then
                cp "$SCRIPT_PATH/ncu" ~/.clv/bin/ncu
            else
                echo "ncu didn't install properly"
            fi
        else
            echo "npm does not exist"
        fi
    fi
else
    docker run -it --rm \
        --entrypoint "ncu" \
        --network host \
        -e PATH="/root/node/bin:$PATH" \
        -v "$HOME/.clv/home:/root" \
        -v "$PWD:/clv" \
        -w "/clv" \
        -a STDOUT \
        node "$@"
fi